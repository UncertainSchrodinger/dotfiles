#!/usr/bin/env zsh
#
# Starts a rojekti layout from the pwd based on some custom heuristics.
#
# Project name is selected based on following heuristics:
# * Uses PWD directory name if not in git repo
# * Uses git root directory name if in git repo
#
# This is safe to call from inside tmux, it'll switch sessions.
#
# If someone else happens to read these I use a private repository for these
# layouts as they contain client names and such. If you want to use this script
# then just create some base layout in ~/.config/rojekti/base.yml and work from
# that. I'd save that to a repository and symlink, so you can share layouts
# between machines. My base layout just contains stuff I usually need, tiled
# layout for services (usually databases, webservers and logs), window for
# editor and one for just messing around.
#
# Up to a point this works with 'tmuxinator', if you just s/rojekti/tmuxinator.

help() {
  echo "tat - rojekti helper utility 6000"
  echo
  echo "usage: tat"
  echo '  tat         # open current $PWD/git-root/git-worktree project'
  echo
  exit 1
}

# Check if we're in a git project, use git root if we are
# Otherwise use current directory
project_path="$(git rev-parse --show-toplevel 2> /dev/null)"

# Use PWD if not in repo
if [ $? -ne 0 ]; then
  project_path="$(print -P %~)"
fi

path_name="$(basename "$project_path" | tr . -)"
session_name="$path_name"

# This works inside tmux session. Easypeasylemonskveesy.
rojekti start $session_name
